name: Keep Alive - Cantinho do Caruru

on:
  schedule:
    # Roda a cada 6 horas (00:00, 06:00, 12:00, 18:00 UTC)
    # Streamlit hiberna ap√≥s 12h sem tr√°fego real ‚Äî 6h d√° folga segura
    - cron: "0 */6 * * *"
  workflow_dispatch: # Permite executar manualmente no GitHub

jobs:
  wake-up:
    runs-on: ubuntu-latest
    timeout-minutes: 5

    steps:
      - name: Instalar Playwright (Chromium)
        run: |
          pip install playwright
          playwright install chromium --with-deps

      - name: Acordar o App com sess√£o real
        run: |
          python3 -c "
          from playwright.sync_api import sync_playwright

          url = 'https://radbrse-caruru-app-coa4y5.streamlit.app/'

          with sync_playwright() as p:
              browser = p.chromium.launch()
              page = browser.new_page()

              print('ü¶ê Acessando Cantinho do Caruru...')
              page.goto(url, wait_until='domcontentloaded', timeout=60000)

              # Aguarda o Streamlit carregar e estabelecer a conex√£o WebSocket
              page.wait_for_selector('[data-testid=\"stApp\"]', timeout=60000)

              # Mant√©m a sess√£o aberta por 5 segundos para garantir o registro
              page.wait_for_timeout(5000)

              print('‚úÖ App acordado! T√≠tulo:', page.title())
              browser.close()
          "
